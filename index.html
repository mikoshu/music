<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>无标题文档</title>
<link href="css/bofang_lay.css" rel="stylesheet" type="text/css" />
</head>

<body>
<div class="bianju_650">
	<div class="top_banner">
    	<div class="denglu_24bk">
        	<a href="#">
        	<div class="denglu_img"><img src="images/img_tx.png" width="24" height="26" /></div>
            <div class="denglu_txt">登录</div>
            </a>
		</div>
        <div class="top_jiantou">
        	<a href="#"><img src="images/left_ico.png" width="12" height="19" /></a>
            <a href="#"><img src="images/right_ico.png" width="11" height="19" /></a>
            <a href="javascript:;" id="reload"><img src="images/update_ico.png" width="20" height="20" /></a>
        </div>
        <div class="top_sousuo">
        <form action="" method="get">
        	<div class="sousuo_input_bk"><input name="textfield" type="text" class="ss_input" id="textfield" value="搜索音效、电音基调......" /></div>
            <div class="sousuo_anniu"><input type="button" class="sousuo_but" value="  " /></div>
        </form>
        </div>
        <div class="ico_youjian"><img src="images/mail_ico.png" width="19" height="15" /></div>
        <div class="ico_shezhi"><img src="images/shezhi_ico.png" width="14" height="15" /></div>
        <div class="ico_tuichu"><img src="images/tuichu_ico.png" width="16" height="17" /></div>
        <div class="ico_suoxiao"><img src="images/suoxiao_ico.png" width="16" height="16" /></div>
        <div class="ico_xiao"><img src="images/xiao_ico.png" width="12" height="3" /></div>
        <div class="ico_close"><img src="images/close_ico.png" width="15" height="16" /></div>
	</div>
	<div class="mid_bk">
    	<div class="mid_left">
        	<div class="left_bbanner">
            	<a href="#"><img src="images/left_ico_1.png" width="14" height="16" /></a>
                <a href="#"><img src="images/left_ico_2.png" width="14" height="16" /></a>
                <a href="#"><img src="images/left_ico_3.png" width="14" height="16" /></a>
                <a href="#"><img src="images/left_ico_4.png" width="14" height="16" /></a>
                <a href="#"><img src="images/left_ico_5.png" width="14" height="16" /></a>
            </div>
			<div class="liebiao_list">
            	<div class="shiting_bk">
                	<!--<div class="shiting_left"><img src="images/shiting_ico.png" width="21" height="17" /></div>-->
                    <div class="shiting_right"><img src="images/xiazai_ico.png" width="17" height="16" /></div>
                </div>
				<div class="moren_list">
					<p class="mrlink_lb">默认分类</p>
					<span><img src="images/lb_ico_shou.png" width="17" height="16" /></span>
                </div>
				<div class="moren_list">
					<p class="mrhover_lb">最近播放</p>
					<span><img src="images/lb_ico_xiala.png" width="17" height="16" /></span>
                </div>
				<ul class="gai_list_2">
					<li>
                    	<a>
						<p class="weixuan">群众笑声</p>
                        <span><img src="images/del_ico.png" width="18" height="17" /></span>
						<span><img src="images/like_ico.png" width="18" height="17" /></span>
                        </a>
					</li>
                    <li class="xuanzhong_lb">
						<p class="xuanz">群众笑声</p>
                        <span><img src="images/del_ico_2.png" width="18" height="17" /></span>
						<span><img src="images/like_ico_2.png" width="18" height="17" /></span>
					</li>
                    <li>
                    	<a>
						<p>群众笑声</p>
                        <span><img src="images/del_ico.png" width="18" height="17" /></span>
						<span><img src="images/like_ico.png" width="18" height="17" /></span>
                        </a>
					</li>
                    <li>
                    	<a>
						<p>群众笑声</p>
                        <span><img src="images/del_ico.png" width="18" height="17" /></span>
						<span><img src="images/like_ico.png" width="18" height="17" /></span>
                        </a>
					</li>
				</ul>
            </div>
			<div class="ce_back"><img src="images/back_tu.jpg" width="128" height="18" /></div>
            <div class="ce_ad_bk"><img src="images/ce_ad.jpg" width="195" height="87" /></div>
        </div>
        <div class="mid_right">
        	<div class="nr_banner">
            	<ul>
                	<li class="nr_banner_jg">我的音效</li>
                    <li>音效库</li>
                    <li>电音库</li>
                    <li>直播工具</li>
                </ul>
            </div>
            <div class="nr_ad">
            	<div class="nr_ad_left"></div>
                <div class="nr_ad_right"></div>
            </div>
            <div class="tiaoshi_bk">
            	<div class="tiaoshi_left_tu"><img src="images/vois_ico.png" width="16" height="16" /></div>
				<div class="tiaoshi_left_txt">声卡调试</div>
				<div class="tiaoshi_left_txt">就找图腾音频</div>
                <div class="toggle_onoff"><a id="sort"></a></div>
                <div class="tiaoshi_right_jia"><img src="images/jia_ico.png" width="14" height="14" /></div>
            </div>
            <div class="list_shengxiao">
            	<ul class="clearfix" id="musicList">
                	<!--遍历文件夹音效内容-->
                </ul>
            </div>
        </div>
    </div>
    <div class="bofang_bk">
    	<div class="bofang_1" id="last" ><img src="images/bofang_ico_1.png" width="23" height="20" /></div>
        <div class="bofang_2" id="play" ><img src="images/bofang_ico_2.png" width="18" height="24" /></div>
        <div class="bofang_3" id="next" ><img src="images/bofang_ico_3.png" width="23" height="20" /></div>
        <div class="jindu_bk">
        	<div class="jindu_shang">
            	<span><img src="images/bofang_ico_hd.png" width="25" height="18" /></span>
                <p id="name"></p>
		  </div>
            <div class="jindu_xia">
            	<div class="jindu_shijian" id="allTime">00:00</div>
                <div class="jindu_tiao">
                    <p class="process"></p>
                </div>
                <div class="jindu_shijian" id="nowTime">00:00</div>
            </div>
        </div>
        <div class="bofang_4"><img src="images/bofang_ico_4.png" width="12" height="16" /></div>
        <div class="bofang_5"><img src="images/bofang_ico_5.png" width="16" height="15" /></div>
        <div class="bofang_6"><img src="images/bofang_ico_6.png" width="19" height="11" /></div>
        <div class="bofang_7"><img src="images/bofang_ico_7.png" width="17" height="12" /></div>
        <div class="shengyin_jindu" id="volume">
		  <p class="volume"></p>
        </div>
         <div class="ce_duihua">12</div>
	</div>
</div>
<audio id="audio" autoplay="autoplay" src='' ></audio>

<script type="text/javascript" src="js/jquery-2.1.1.min.js" ></script>
<script type="text/javascript" src="js/Sortable.js" ></script>
<script type="text/javascript" src="js/util.js" ></script>
<script>
    var fs = require('fs');
    var path = require('path');
    var musicURL = path.join(process.cwd(),'player/musics/');
    var index = 0; // 默认选中第一个音效
    var file = [];
    var isPlaying = false;
    var audio = document.getElementById('audio');
    var Timmer;

    $(document).ready(function(){
        util.init(); // 初始化
        util.refreshList(); // 渲染列表

        $("#reload").click(function(){ // 刷新图标刷新页面
            window.location.reload();
        })

        audio.onplaying = function(){ // 音频播放
            isPlaying = true;
            $("#allTime").html(util.getTime(audio.duration))
            Timmer = setInterval(function(){ //控制时间与进度条
                $("#nowTime").html(util.getTime(audio.currentTime))
                var per = parseInt((audio.currentTime/audio.duration)*100);
                $(".process").css('width',per+'%');
            },500)
        }

        audio.onpause = function (){// 音频暂停
            isPlaying = false;
            clearInterval(Timmer)
        }

        audio.onended = function(){ // 音频结束
            $("#nowTime").html(util.getTime(audio.duration))
            $(".process").css('width','100%');
            clearInterval(Timmer)
        }

        audio.onerror = function(err){
            console.log(audio.src)
            if(audio.src != 'chrome-extension://ppchnfigajpiiponlijgmmhaknifgjhj/player/index.html'){
                alert('该音效文件不存在或路径发生变化!')
            }
        }


        $("#musicList").delegate('li','click',function(){ // 点击音效列表播放音效
            var url = $(this).find('a').attr('data-url');
            $("#audio").attr('src',url);
            $("#name").html($(this).text());
            index = $(this).index()
        })

        $("#play").click(function(){ // 点击播放按钮事件（此处按钮样式需要改变）
            var url = $("#audio").attr('src');
            if(url == ''){
                $("#audio").attr('src',file[index].fileURL);
            }
            if(isPlaying){
                audio.pause()
            }else{
                play()
            }
            
        })
        $("#last").click(function(){ // 上一首
            index -= 1;
            if(index == -1){
                alert('已经是第一首');
            }else{
              $("#audio").attr('src',file[index].fileURL);
                play();  
            } 
        })
        $("#next").click(function(){ // 下一首
            index += 1;
            if(index == file.length){
                alert('已经是最后一首');
            }else{
              $("#audio").attr('src',file[index].fileURL);
                play(); 
            } 
        })

        function play(){
            audio.play()
            $("#name").html(file[index].fileName) 
            
            //console.log(audio.volume)
        }

        /** 声音控制器模拟 **/
        var changeVolume = false;
        var maxWidth = 47;
        $("#volume").mousedown(function(){
            changeVolume = true;
        })
        $("#volume").mouseup(function(e){
            changeVolume = false;
            getPer(e);
        })
        $("body").mouseup(function(){
            changeVolume = false;
        })
        $('body').mousemove(function(e){
            if(changeVolume){
                getPer(e)
            }
        })

        function getPer(e){ // 音量获取
            var left = (e.clientX - $("#volume")[0].getBoundingClientRect().left);
            if(left < 0){
                left = 0;
            }else if(left > maxWidth){
                left = maxWidth;
            }
            var per = parseInt((left / maxWidth)*100);
            $("#volume").find('p').css('width',per+'%');
            audio.volume = per/100;
        } 
        /**声音控制器模拟结束 **/
        $(".ico_close").click(function(){
            var win = nw.Window.get();
            win.close()
        })
        $(".ico_xiao").click(function(){
            var win = nw.Window.get();
            win.minimize()
        })
        $(".ico_suoxiao").click(function(){
            var win = nw.Window.get();
            win.maximize()
        })

        /***排序按钮开关***/
        var s;
        $("#sort").on('click',function(){
            if($(this).hasClass('on')){
                $(this).removeClass('on');
                $(".list_shengxiao").removeClass('sort');
                s.destroy();
            }else{
                $(this).addClass('on');
                $(".list_shengxiao").addClass('sort');
                var bar = document.getElementById('musicList');
                s = Sortable.create(bar, {  // 用sortable实现可拖拽排序
                    animation: 150,
                    onEnd: function(){ // 排序结束后更改localstorage.file文件
                        util.getRightList();
                    }
                });
            }
        })

        
        /**列表删除**/
        $("#musicList").delegate('span','click',function(e){
            e.stopPropagation();
            var fileURL = $(this).parent().attr('data-url');
            var fileName = $(this).parent().text();
            util.deleteFile(fileURL,fileName);
        });

    })

    

</script>
</body>
</html>
